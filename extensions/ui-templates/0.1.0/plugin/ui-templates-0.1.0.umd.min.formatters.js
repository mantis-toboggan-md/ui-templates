(("undefined"!==typeof self?self:this)["webpackChunkui_templates_0_1_0"]=("undefined"!==typeof self?self:this)["webpackChunkui_templates_0_1_0"]||[]).push([[902],{3292:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var n=a(9274);const i={class:"wider"};function r(e,t,a,r,l,s){const o=(0,n.resolveComponent)("LabeledSelect");return(0,n.openBlock)(),(0,n.createElementBlock)("div",i,[(0,n.createVNode)(o,{loading:e.$fetchState.pending,label:"Kubernetes Version",options:s.k3sVersionOptions||[],value:a.value,"onUpdate:value":t[0]||(t[0]=t=>e.$emit("update:value",t))},null,8,["loading","options","value"])])}var l=a(58946),s={name:"K3sVersionTemplateFormatter",emits:["update:value"],components:{LabeledSelect:l.A},props:{value:{type:String,default:null}},async fetch(){this.k3sVersions=await this.$store.dispatch("management/request",{url:"/v1-k3s-release/releases"})},data(){return{k3sVersions:{}}},watch:{k3sVersionOptions(e=[]){this.value||this.$emit("update:value",e[0])}},computed:{k3sVersionOptions(){return(this.k3sVersions?.data||[]).map(e=>e.version).reverse()}}},o=a(47433);const d=(0,o.A)(s,[["render",r]]);var c=d},8894:function(e,t,a){"use strict";a.r(t);var n=a(40429),i=a.n(n),r=a(1214),l=a.n(r),s=l()(i());s.push([e.id,".role[data-v-c4be6d5a]{display:flex;align-items:center;flex-direction:row}",""]),t["default"]=s},37982:function(e,t,a){var n=a(8894);n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);var i=a(74825).A;i("09bf3912",n,!0,{sourceMap:!1,shadowMode:!1})},43405:function(e,t,a){var n=a(94573);n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.id,n,""]]),n.locals&&(e.exports=n.locals);var i=a(74825).A;i("2d03fe9a",n,!0,{sourceMap:!1,shadowMode:!1})},62645:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return q}});var n=a(9274);function i(e,t,a,i,r,l){const s=(0,n.resolveComponent)("ClusterMembershipEditor");return(0,n.openBlock)(),(0,n.createBlock)(s,{mode:"create","parent-id":null,onMembershipUpdate:l.onMembershipUpdate},null,8,["onMembershipUpdate"])}var r=a(35664);function l(e,t,a,i,r,l){const s=(0,n.resolveComponent)("MembershipEditor");return(0,n.openBlock)(),(0,n.createBlock)(s,(0,n.mergeProps)(e.$attrs,{"add-member-dialog-name":"AddClusterMemberDialog","default-binding-handler":l.defaultBindingHandler,type:r.NORMAN.CLUSTER_ROLE_TEMPLATE_BINDING,mode:a.mode,"parent-key":"clusterId","parent-id":a.parentId}),null,16,["default-binding-handler","type","mode","parent-id"])}var s=a(14220);const o={class:"box mb-0"},d={class:"column-headers row"},c={class:"col span-6"},p={class:"text-label"},m={class:"col span-6"},u={class:"text-label"},h={class:"columns row"},g={class:"col span-6"},v=["data-testid"],f={key:0},y=["disabled","data-testid","onClick"];function b(e,t,a,i,r,l){const s=(0,n.resolveComponent)("Loading"),b=(0,n.resolveComponent)("Principal"),k=(0,n.resolveComponent)("ArrayList");return e.$fetchState.pending?((0,n.openBlock)(),(0,n.createBlock)(s,{key:0})):((0,n.openBlock)(),(0,n.createBlock)(k,{key:1,value:r.bindings,"onUpdate:value":t[1]||(t[1]=e=>r.bindings=e),mode:a.mode,"show-header":!0},{"column-headers":(0,n.withCtx)(()=>[(0,n.createElementVNode)("div",o,[(0,n.createElementVNode)("div",d,[(0,n.createElementVNode)("div",c,[(0,n.createElementVNode)("label",p,(0,n.toDisplayString)(e.t("membershipEditor.user")),1)]),(0,n.createElementVNode)("div",m,[(0,n.createElementVNode)("label",u,(0,n.toDisplayString)(e.t("membershipEditor.role")),1)])])])]),columns:(0,n.withCtx)(({row:e,i:t})=>[(0,n.createElementVNode)("div",h,[(0,n.createElementVNode)("div",g,[(0,n.createVNode)(b,{value:e.value.principalId},null,8,["value"])]),(0,n.createElementVNode)("div",{"data-testid":`role-item-${t}`,class:"col span-6 role"},(0,n.toDisplayString)(e.value.roleDisplay),9,v)])]),add:(0,n.withCtx)(()=>[(0,n.createElementVNode)("button",{type:"button",class:"btn role-primary mt-10","data-testid":"add-item",onClick:t[0]||(t[0]=(...e)=>l.addMember&&l.addMember(...e))},(0,n.toDisplayString)(e.t("generic.add")),1)]),"remove-button":(0,n.withCtx)(({remove:t,i:a})=>[l.isCreate&&0===a||l.isView?((0,n.openBlock)(),(0,n.createElementBlock)("span",f)):((0,n.openBlock)(),(0,n.createElementBlock)("button",{key:1,type:"button",disabled:l.isView,class:"btn role-link","data-testid":`remove-item-${a}`,onClick:t},(0,n.toDisplayString)(e.t("generic.remove")),9,y))]),_:1},8,["value","mode"]))}var k=a(10505);const E={class:"avatar"},N=["src","alt"],B={key:0,class:"name"},V={class:"name"},w={class:"avatar"},C={class:"name text-error"};function S(e,t,a,i,r,l){const s=(0,n.resolveDirective)("clean-html"),o=(0,n.resolveDirective)("t");return(0,n.openBlock)(),(0,n.createElementBlock)("div",{class:(0,n.normalizeClass)(["principal",{showLabels:a.showLabels}])},[!r.principal&&e.$fetchState.pending?((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:0},[t[0]||(t[0]=(0,n.createElementVNode)("div",{class:"avatar"},[(0,n.createElementVNode)("div",{class:"empty"},[(0,n.createElementVNode)("i",{class:"icon icon-spinner icon-lg"})])],-1)),(0,n.withDirectives)((0,n.createElementVNode)("div",{class:(0,n.normalizeClass)(["name",{"text-muted":a.useMuted}])},null,2),[[s,e.t("principal.loading",null,!0)]]),t[1]||(t[1]=(0,n.createElementVNode)("div",{class:"description"},null,-1))],64)):r.principal?((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:1},[(0,n.createElementVNode)("div",E,[(0,n.createElementVNode)("img",{src:r.principal.avatarSrc,class:(0,n.normalizeClass)({round:r.principal.roundAvatar}),alt:e.t("principal.alt.avatar")},null,10,N)]),a.showLabels?((0,n.openBlock)(),(0,n.createElementBlock)("div",B,[(0,n.createElementVNode)("table",null,[(0,n.createElementVNode)("tbody",null,[(0,n.createElementVNode)("tr",null,[(0,n.createElementVNode)("th",null,(0,n.toDisplayString)(e.t("principal.name"))+": ",1),(0,n.createElementVNode)("td",null,(0,n.toDisplayString)(r.principal.name||r.principal.loginName),1)]),(0,n.createElementVNode)("tr",null,[(0,n.createElementVNode)("th",null,(0,n.toDisplayString)(e.t("principal.loginName"))+": ",1),(0,n.createElementVNode)("td",null,(0,n.toDisplayString)(r.principal.loginName),1)]),(0,n.createElementVNode)("tr",null,[(0,n.createElementVNode)("th",null,(0,n.toDisplayString)(e.t("principal.type"))+": ",1),(0,n.createElementVNode)("td",null,(0,n.toDisplayString)(r.principal.displayType),1)])])])])):((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:1},[(0,n.createElementVNode)("div",V,[l.showBoth?((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:0},[(0,n.createTextVNode)((0,n.toDisplayString)(r.principal.name)+" ",1),r.principal.loginName?((0,n.openBlock)(),(0,n.createElementBlock)("span",{key:0,class:(0,n.normalizeClass)({"text-muted":a.useMuted})},"("+(0,n.toDisplayString)(r.principal.loginName)+")",3)):(0,n.createCommentVNode)("",!0)],64)):r.principal.name?((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:1},[(0,n.createTextVNode)((0,n.toDisplayString)(r.principal.name),1)],64)):((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:2},[(0,n.createTextVNode)((0,n.toDisplayString)(r.principal.loginName),1)],64))]),(0,n.createElementVNode)("div",{class:(0,n.normalizeClass)(["description",{"text-muted":a.useMuted}])},(0,n.toDisplayString)(r.principal.displayType),3)],64))],64)):((0,n.openBlock)(),(0,n.createElementBlock)(n.Fragment,{key:2},[(0,n.createElementVNode)("div",w,[(0,n.createElementVNode)("div",{class:(0,n.normalizeClass)(["empty",{"text-muted":a.useMuted}])},t[2]||(t[2]=[(0,n.createElementVNode)("i",{class:"icon icon-warning icon-lg"},null,-1)]),2)]),(0,n.withDirectives)((0,n.createElementVNode)("div",C,null,512),[[o,"principal.error"]]),(0,n.createElementVNode)("div",{class:(0,n.normalizeClass)(["description",{"text-muted":a.useMuted}])},(0,n.toDisplayString)(a.value),3)],64))],2)}var M=a(4364),x={props:{value:{type:String,required:!0},useMuted:{type:Boolean,default:!0},showLabels:{type:Boolean,default:!1}},async fetch(){this.loadData()},data(){return{principal:null}},computed:{showBoth(){const e=this.principal;return e.name&&e.loginName&&e.name.trim().toLowerCase()!==e.loginName.trim().toLowerCase()}},methods:{async loadData(){if(this.principal=this.$store.getters["rancher/byId"](r.k$.PRINCIPAL,this.value),this.principal)return;const e=escape(this.value).replace(/\//g,"%2F");try{this.principal=await this.$store.dispatch("rancher/find",{type:r.k$.PRINCIPAL,id:this.value,opt:{url:`/v3/principals/${e}`}})}catch(t){M.error("Failed to fetch principal",this.value,e)}}},watch:{value(){this.loadData()}}},A=(a(43405),a(47433));const D=(0,A.A)(x,[["render",S],["__scopeId","data-v-2e3be36f"]]);var I=D,L=a(12570),$=a(76978);function _(e){return e?.replace(":","/")||e}var T={emits:["membership-update"],components:{ArrayList:k.A,Loading:L.A,Principal:I},props:{addMemberDialogName:{type:String,required:!0},parentKey:{type:String,required:!0},parentId:{type:String,default:null},mode:{type:String,required:!0},type:{type:String,required:!0},defaultBindingHandler:{type:Function,default:null},modalSticky:{type:Boolean,default:!1}},async fetch(){const e={type:this.type,opt:{force:!0}};this.type===r.k$.PROJECT_ROLE_TEMPLATE_BINDING&&this.parentId&&Object.assign(e,{opt:{filter:{projectId:this.parentId.split("/").join(":")},force:!0}});const t=[this.schema?this.$store.dispatch("rancher/findAll",e):[],this.$store.dispatch("rancher/findAll",{type:r.k$.PRINCIPAL}),this.$store.dispatch("management/findAll",{type:r.Mc.ROLE_TEMPLATE}),this.$store.dispatch("management/findAll",{type:r.Mc.USER})],[a]=await Promise.all(t),n=a.filter(e=>_((0,$.Jt)(e,this.parentKey))===_(this.parentId));if(this["lastSavedBindings"]=[...n],this.mode===s.YQ&&0===n.length&&this.defaultBindingHandler){const e=await this.defaultBindingHandler();e.isDefaultBinding=!0,n.push(e)}this["bindings"]=n},data(){return{schema:this.$store.getters["rancher/schemaFor"](this.type),bindings:[],lastSavedBindings:[]}},computed:{newBindings(){return this.bindings.filter(e=>!e.id&&!this.lastSavedBindings.includes(e)&&!e.isDefaultBinding)},removedBindings(){return this.lastSavedBindings.filter(e=>!this.bindings.includes(e))},membershipUpdate(){const e=this.newBindings,t=this.removedBindings;return{newBindings:this.newBindings,removedBindings:this.removedBindings,save:a=>{const n=e.map(e=>((0,$.hZ)(e,this.parentKey,a),e.save())),i=t.map(e=>e.remove());return Promise.all([...n,...i])}}},isCreate(){return this.mode===s.YQ},isView(){return this.mode===s.nW}},watch:{membershipUpdate:{deep:!0,handler(){this.$emit("membership-update",this.membershipUpdate)}}},methods:{addMember(){this.$store.dispatch("cluster/promptModal",{component:this.addMemberDialogName,componentProps:{onAdd:this.onAddMember},modalSticky:this.modalSticky})},onAddMember(e){this["bindings"]=[...this.bindings,...e]}}};a(37982);const R=(0,A.A)(T,[["render",b],["__scopeId","data-v-c4be6d5a"]]);var P=R;var U={components:{MembershipEditor:P},props:{parentId:{type:String,default:null},mode:{type:String,required:!0}},data(){return{NORMAN:r.k$,bindings:[],lastSavedBindings:[]}},computed:{isCreate(){return this.mode===s.YQ},isView(){return this.mode===s.nW}},methods:{defaultBindingHandler(){return this.$store.dispatch("rancher/create",{type:r.k$.CLUSTER_ROLE_TEMPLATE_BINDING,roleTemplateId:"cluster-owner",userPrincipalId:this.$store.getters["auth/principalId"]})}}};const O=(0,A.A)(U,[["render",l]]);var F=O,j={name:"ClusterMembershipTemplateFormatter",components:{ClusterMembershipEditor:F},props:{value:{type:[Object,Array,Number,String,Boolean],default:null},variableDefinition:{type:Object,default:()=>({})},uitemplate:{type:Object,default:()=>({})},globalVariableConfiguration:{type:Array,default:()=>[]},resourceConfiguration:{type:Object,default:()=>({})},registerBeforeHook:{type:Function,default:()=>{}},registerAfterHook:{type:Function,default:()=>{}}},created(){this.registerAfterHook(this.saveRoleBindings,"saveRoleBindings")},data(){return{membershipUpdate:null}},methods:{async getNormanCluster(){const e=Object.keys(this.resourceConfiguration).find(e=>{const t=this.resourceConfiguration[e],a=t.find(e=>e.objectToBePatched?.type===r.qt.RANCHER_CLUSTER);return!!a}),t=e.objectToBePatched,a=await this.$store.dispatch("management/find",{type:r.qt.RANCHER_CLUSTER,id:`${t?.metadata?.namespace}/${t?.metadata?.name}`});return await a.findNormanCluster()},onMembershipUpdate(e){this["membershipUpdate"]=e},async saveRoleBindings(){const e=this.getNormanCluster();this.membershipUpdate?.save&&await this.membershipUpdate.save(e.id)}}};const H=(0,A.A)(j,[["render",i]]);var q=H},94573:function(e,t,a){"use strict";a.r(t);var n=a(40429),i=a.n(n),r=a(1214),l=a.n(r),s=l()(i());s.push([e.id,'.principal[data-v-2e3be36f]{display:grid;grid-template-areas:"avatar name" "avatar description";grid-template-columns:40px auto;grid-template-rows:auto 20px;-moz-column-gap:10px;column-gap:10px}.principal th[data-v-2e3be36f]{text-align:left;font-weight:400;padding-right:10px}.principal.showLabels[data-v-2e3be36f]{grid-template-areas:"avatar name";grid-template-columns:60px auto;grid-template-rows:60px;-moz-column-gap:0;column-gap:0}.principal.showLabels .name[data-v-2e3be36f]{line-height:unset}.principal.showLabels table tr td[data-v-2e3be36f]:not(:first-of-type){padding-left:10px}.principal .avatar[data-v-2e3be36f]{grid-area:avatar;text-align:center}.principal .avatar DIV.empty[data-v-2e3be36f]{border:1px solid var(--border);line-height:40px}.principal .avatar IMG[data-v-2e3be36f]{width:40px;height:40px}.principal .avatar DIV.round[data-v-2e3be36f],.principal .avatar IMG.round[data-v-2e3be36f]{border-radius:50%}.principal .name[data-v-2e3be36f]{grid-area:name;line-height:20px;overflow-wrap:anywhere}.principal .description[data-v-2e3be36f]{grid-area:description;line-height:20px}',""]),t["default"]=s}}]);
//# sourceMappingURL=ui-templates-0.1.0.umd.min.formatters.js.map